<div style="margin: 0;" class="p-grid">
    <div class="p-col-12">
        <button
            type="button"
            pButton
            label="Refresh App"
            icon="pi pi-refresh"
            (click)="refreshAppState()"
            style="float: right;"
        ></button>
        <h3>Kea App {{ appTab.app.id }}.</h3>
        Machine:
        <a routerLink="/machines/{{ appTab.app.machine.id }}">{{ appTab.app.machine.address }}</a>
    </div>

    <div class="p-col-12" style="padding: 0;">
        <p-tabView [activeIndex]="activeTabIndex">
            <p-tabPanel *ngFor="let daemon of daemons">
                <ng-template pTemplate="header">
                    <div>
                        <span
                            class="pi {{ daemonStatusIconName(daemon) }}"
                            style="font-size: 1.6em; vertical-align: bottom; color: {{
                                daemonStatusIconColor(daemon)
                            }};"
                        ></span>
                        <span style="margin-right: 0.5em; font-weight: bold;">
                            {{ daemon.niceName }}
                        </span>
                    </div>
                </ng-template>

                <ng-template pTemplate="content">
                    <div class="p-grid" style="padding: 0;">
                        <div *ngIf="daemon.active" class="p-col-12">
                            <button
                                routerLink="/dhcp/hosts"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Host Reservations"
                                icon="fa fa-laptop"
                                class="ui-button-secondary"
                                type="button"
                                pButton
                                style="margin-right: 16px;"
                            ></button>
                            <button
                                routerLink="/dhcp/subnets"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Subnets"
                                icon="fa fa-project-diagram"
                                type="button"
                                class="ui-button-secondary"
                                pButton
                                style="margin-right: 16px;"
                            ></button>
                            <button
                                routerLink="/dhcp/shared-networks"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Shared Networks"
                                icon="fa fa-network-wired"
                                class="ui-button-secondary"
                                type="button"
                                pButton
                            ></button>
                        </div>

                        <div *ngIf="daemon.statusErred" class="p-col-4">
                            <p-message severity="error" text="{{ daemonStatusErrorText(daemon) }}"></p-message>
                        </div>
                        <div *ngIf="daemon.statusErred" class="p-col-8"></div>

                        <div *ngIf="!daemon.active" class="p-col-4">
                            <p-message
                                severity="warn"
                                text="This daemon is not monitored by Stork as it was not running at the time when the machine was added to Stork. The configuration for this daemon was detected in the Kea Control Agent's configuration file. That's why it appears on the list of daemons."
                            ></p-message>
                        </div>
                        <div *ngIf="!daemon.active" class="p-col-8"></div>

                        <div *ngIf="daemon.active" class="p-col-12">
                            <h4 style="margin-top: 2px;">Overview</h4>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 10rem;">Version</td>
                                    <td>{{ daemon.version }}</td>
                                </tr>
                                <tr>
                                    <td style="width: 10rem; vertical-align: top;">Version Ext</td>
                                    <td [innerHTML]="daemon.extendedVersion"></td>
                                </tr>
                                <tr>
                                    <td style="with: 10rem; vertical-align: top;">Hooks</td>
                                    <td>
                                        <div *ngFor="let hook of daemon.hooks">
                                            {{ hook }}
                                        </div>
                                        <div *ngIf="daemon.hooks.length === 0" style="color: #aaa;">
                                            no hooks
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 10rem; vertical-align: top;">Uptime</td>
                                    <td>{{ showDuration(daemon.uptime) }}</td>
                                </tr>
                                <tr>
                                    <td style="width: 10rem; vertical-align: top;">Last Reloaded At</td>
                                    <td>{{ daemon.reloadedAt | localtime }}</td>
                                </tr>
                            </table>
                        </div>
                        <div *ngIf="daemon.active" class="p-col-7">
                            <h4 style="margin-top: 2px;">Loggers</h4>
                            <p-table [value]="daemon.logTargets">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th style="width: 10rem;">Logger</th>
                                        <th style="width: 7rem;">Severity</th>
                                        <th style="width: 30rem;">Output Location</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-logTarget>
                                    <tr>
                                        <td>{{ logTarget.name }}</td>
                                        <td align="center">{{ logTarget.severity }}</td>
                                        <td>
                                            <i *ngIf="!logTargetViewable(logTarget.output)">{{ logTarget.output }}</i>
                                            <a
                                                *ngIf="logTargetViewable(logTarget.output)"
                                                routerLink="/logs/{{ logTarget.id }}"
                                                ><i>{{ logTarget.output }}</i></a
                                            >
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage" let-columns>
                                    <tr>
                                        <td [attr.colspan]="3">
                                            No loggers found
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>

                        <div
                            *ngIf="daemon.active && (daemon.name === 'dhcp4' || daemon.name === 'dhcp6')"
                            class="p-col-12"
                        >
                            <app-ha-status [appId]="appTab.app.id" [daemonName]="daemon.name"></app-ha-status>
                        </div>
                    </div>
                </ng-template>
            </p-tabPanel>
        </p-tabView>
    </div>
</div>
