<div style="margin: 0;" class="p-grid">
    <div class="p-col-12">
        <button
            type="button"
            pButton
            label="Refresh App"
            icon="pi pi-refresh"
            (click)="refreshAppState()"
            style="float: right;"
        ></button>
        <h3>Kea App {{ appTab.app.id }}.</h3>
        Machine:
        <a routerLink="/machines/{{ appTab.app.machine.id }}">{{ appTab.app.machine.address }}</a>
    </div>

    <div class="p-col-12" style="padding: 0;">
        <p-tabView [activeIndex]="activeTabIndex">
            <p-tabPanel *ngFor="let daemon of daemons">
                <ng-template pTemplate="header">
                    <div>
                        <span
                            class="pi {{ daemonStatusIconName(daemon) }}"
                            style="font-size: 1.6em; vertical-align: bottom; color: {{
                                daemonStatusIconColor(daemon)
                            }};"
                        ></span>
                        <span style="margin-right: 0.5em; font-weight: bold;">
                            {{ daemon.niceName }}
                        </span>
                    </div>
                </ng-template>

                <ng-template pTemplate="content">
                    <div class="p-grid" style="padding: 0;">
                        <div class="p-col-12">
                            <button
                                routerLink="/dhcp/hosts"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Host Reservations"
                                icon="fa fa-laptop"
                                class="ui-button-secondary"
                                type="button"
                                pButton
                                style="margin-right: 16px;"
                            ></button>
                            <button
                                routerLink="/dhcp/subnets"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Subnets"
                                icon="fa fa-project-diagram"
                                type="button"
                                class="ui-button-secondary"
                                pButton
                                style="margin-right: 16px;"
                            ></button>
                            <button
                                routerLink="/dhcp/shared-networks"
                                [queryParams]="{ appId: appTab.app.id }"
                                label="Shared Networks"
                                icon="fa fa-network-wired"
                                class="ui-button-secondary"
                                type="button"
                                pButton
                            ></button>
                        </div>

                        <div *ngIf="daemonStatusErred(daemon)" class="p-col-4">
                            <p-message severity="error" [text]="daemonStatusErrorText(daemon)"></p-message>
                        </div>
                        <div *ngIf="daemonStatusErred(daemon)" class="p-col-8"></div>

                        <div *ngIf="!daemon.active" class="p-col-4">
                            <p-message
                                severity="info"
                                text="This server is not monitored by Stork as it was not running at the time when the machine was added to Stork. The configuration for this server was detected in the Kea Control Agent's configuration file. That's why it appears on the list of daemons."
                            ></p-message>
                        </div>
                        <div *ngIf="!daemon.active" class="p-col-8"></div>

                        <div *ngIf="daemon.active" class="p-col-4">
                            <h4 style="margin-top: 2px;">Overview</h4>
                            <p-panel>
                                <p-header> Kea {{ daemon.niceName }} daemon details </p-header>
                                <table style="width: 100%;">
                                    <tr>
                                        <td>Version</td>
                                        <td>{{ daemon.version }}</td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: top;">Version Ext</td>
                                        <td [innerHTML]="daemon.extendedVersion"></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: top;">Hooks</td>
                                        <td>
                                            <div *ngFor="let hook of daemon.hooks">
                                                {{ hook }}
                                            </div>
                                            <div *ngIf="daemon.hooks.length === 0" style="color: #aaa;">
                                                no hooks
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: top;">Uptime</td>
                                        <td>{{ showDuration(daemon.uptime) }}</td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: top;">Last Reloaded At</td>
                                        <td>{{ daemon.reloadedAt | localtime }}</td>
                                    </tr>
                                </table>
                            </p-panel>
                        </div>

                        <div
                            *ngIf="daemon.active && (daemon.name === 'dhcp4' || daemon.name === 'dhcp6')"
                            class="p-col-4"
                        >
                            <app-ha-status [appId]="appTab.app.id" [daemonName]="daemon.name"></app-ha-status>
                        </div>
                    </div>
                </ng-template>
            </p-tabPanel>
        </p-tabView>
    </div>
</div>
